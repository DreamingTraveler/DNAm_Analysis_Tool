{% extends "base/layout.html" %} 
{% block main%}
<div class="columns">
	<nav class="panel column is-one-quarter" id="main-panel">
	  <p class="panel-heading">
	    Differential Methylation Positions (DMPs) Overview
	  </p>

	  <p class="panel-tabs" id="cancer-option">
	    <a class="is-active" data-cancer-type="colorectal">Colorectal</a>
	    <a data-cancer-type="bladder">Bladder</a>
	  </p>

	  <div class="panel-block">
	  	<div class="field">
	  		<label><b>Race:</b></label>

			  <input class="is-checkradio" id="race-radio-asian" type="radio" name="race-radio" checked="checked">
			  <label for="race-radio-asian">Asian</label>

			  <input class="is-checkradio" id="race-radio-black" type="radio" name="race-radio">
			  <label for="race-radio-black">Black</label>

			  <input class="is-checkradio" id="race-radio-white" type="radio" name="race-radio">
			  <label for="race-radio-white">White</label>
			</div>
	  </div>

	  <div class="panel-block">
	    <p class="control has-icons-left">
	      <input class="input" id="search-dmp" type="text" placeholder="Search">
	      <span class="icon is-left">
	        <i class="fas fa-search" aria-hidden="true"></i>
	      </span>
	    </p>
	  </div>

	  <div class="panel-block">
		  <div class="field" id="search-filter-options">
			  <input class="is-checkradio" id="search-filter-radio-probe" type="radio" name="search-filter-radio" value="probe" checked="checked">
			  <label for="search-filter-radio-probe">Probe ID</label>

			  <input class="is-checkradio" id="search-filter-radio-gene" type="radio" name="search-filter-radio" value="gene">
			  <label for="search-filter-radio-gene">Gene name</label>
			</div>
		</div>

	  
	  <p class="panel-block">
	  	<p style="text-align: center;">abs(logFC) threshold</p>
	    <input class="slider is-fullwidth" id="logFC-threshold" step="0.01" min="0" max="1" value="0" type="range">
	    <p style="text-align: center; margin-bottom: 10px;" id="threshold-val">Threshold value: 0 </p>

  		<div class="field" id="hyper-hypo-checker">
			  <input id="is-hyper" type="checkbox" name="is-hyper" class="switch" checked="checked">
			  <label for="is-hyper">Hyper</label>

			  <input id="is-hypo" type="checkbox" name="is-hypo" class="switch" checked="checked">
			  <label for="is-hypo">Hypo</label>
			</div>
	  </p>

	  <!-- <a class="panel-block is-active">
	    <span class="panel-icon">
	      <i class="fas fa-book" aria-hidden="true"></i>
	    </span>
	    bulma
	  </a>
	 
	  <a class="panel-block">
	    <span class="panel-icon">
	      <i class="fas fa-code-branch" aria-hidden="true"></i>
	    </span>
	    daniellowtw/infboard
	  </a>
	  <a class="panel-block">
	    <span class="panel-icon">
	      <i class="fas fa-code-branch" aria-hidden="true"></i>
	    </span>
	    mojs
	  </a> -->

	  <div class="panel-block">
	    <button class="button is-link is-outlined is-fullwidth">
	      Reset all filters
	    </button>
	  </div>
	</nav>

	<section class="column">
		<div class="tabs is-boxed">
		  <ul>
		    <li class="is-active">
		      <a>
		        <span>DMPs table</span>
		      </a>
		    </li>
		    <li>
		      <a>
		        <span>???</span>
		      </a>
		    </li>
		    <li>
		      <a>
		        <span>???</span>
		      </a>
		    </li>
		    <li>
		      <a>
		        <span>???</span>
		      </a>
		    </li>
		  </ul>
		</div>
		
		<div id="dmp-info-area">
			<table class="table is-striped" id="dmp-display-table">
		    <thead>
	        <tr>
	          <th>Probe ID</th>
            <th><abbr title="log2 fold change">logFC</abbr></th>
            <th><abbr title="t value">t</abbr></th>
            <th>P.Value</th>
            <th><abbr title="Chromosome">CHR</abbr></th>
            <th><abbr title="Map information">MAPINFO</abbr></th>
            <th>gene</th>
            <th>feat.cgi</th>
	        </tr>
		    </thead>
		    <tbody>
		      {% for dmp in dmp_list %}
	        <tr>
	            <th>{{dmp.probe_id}}</th>
	            <td>{{dmp.logFC}}</td>
	            <td>{{dmp.t_val}}</td>
	            <td>{{dmp.p_val}}</td>
	            <td>{{dmp.chr}}</td>
	            <td>{{dmp.coord}}</td>
	            <td>{{dmp.gene}}</td>
	            <td>{{dmp.feat_cgi}}</td>
	        </tr>
		      {% endfor %}
		    </tbody>
			</table>
			{% from 'base/pagination.html' import pagination %}
			{% set page = page | int %}
			{% set total_page = total_page | int %}
			{{ pagination(page, total_page) }}
		</div>
	</section>
</div>

<script type="text/javascript">
	(function () {
		$.removeCookie('searchFilterText');
		$.removeCookie('searchFilterOption');
		$.removeCookie('logFCThreshold');
		$.removeCookie('cancerType');

		setMethyStatus(); // initialize the methylation status (use cookie to store)
		updateTableContent();

		function setMethyStatus() {
			$.cookie('isHyper', $("#is-hyper").is(":checked"))
			$.cookie('isHypo', $("#is-hypo").is(":checked"))
		}

		function updateTableContent() {
			$.ajax({
    	  url: '{{ url_for("main.MainView") }}',
	      type: 'POST',
        success: function(block)
        {
					$("#dmp-info-area").html(block);

        },
        error: function(response)
        {
          console.log(response);
        } 
	    });
		}

		$("#search-dmp").keyup(function() {
			var inputText = $(this).val();
			var searchFilterOpt = $('input[name=search-filter-radio]:checked').val();

			$.cookie('page', 1);
			$.cookie('searchFilterText', inputText);
			$.cookie('searchFilterOption', searchFilterOpt);

			updateTableContent();
		})

		$("#search-filter-options").change(function() {
			var searchFilterOpt = $('input[name=search-filter-radio]:checked').val();

			$("#search-dmp").val("");
			$.cookie('page', 1);
			$.cookie('searchFilterText', "");
			$.cookie('searchFilterOption', searchFilterOpt);

			updateTableContent();
		})

		$("#logFC-threshold").on("input", function() {
			var threshold = $(this).val();

			$.cookie('page', 1);
			$.cookie('logFCThreshold', threshold);
			$("#threshold-val").html("Threshold value: " + threshold)

			updateTableContent();
		})

		$("#is-hyper, #is-hypo").change(function() {
			$.cookie('page', 1);
			setMethyStatus()
			updateTableContent();
		})

		$(".pagination-link").click(function(event) {
      event.preventDefault();
      var page = $(this).data("page");
      $.cookie('page', page);
      updateTableContent();
    	
    })

		$("#cancer-option > a").click(function() {
			var cancerType = $(this).data("cancer-type");
			$.cookie('cancerType', cancerType);

			updateTableContent();
		})


	})();
</script>

{% endblock %}